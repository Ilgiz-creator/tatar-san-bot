# tatar-san-bot

–¢–µ–ª–µ–≥—Ä–∞–º-–±–æ—Ç, —Å–¥–µ–ª–∞–Ω–Ω—ã–π –¥–ª—è —Ö–∞–∫–∞—Ç–æ–Ω–∞ **Tatar SAN**.  
–û—Å–Ω–æ–≤–Ω–∞—è –∏–¥–µ—è ‚Äî –±–µ–∑–æ–ø–∞—Å–Ω—ã–π —á–∞—Ç-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç, –∫–æ—Ç–æ—Ä—ã–π:

- —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç –º–∞—Ç –∏ –æ–ø–∞—Å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã;
- –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –±–æ–ª–µ–µ –Ω–µ–π—Ç—Ä–∞–ª—å–Ω—É—é —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫—É;
- –ø—Ä–∏ —Å–æ–≥–ª–∞—Å–∏–∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ø–µ—Ä–µ—Ñ—Ä–∞–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∑–∞–ø—Ä–æ—Å –≤ –º–æ–¥–µ–ª—å OpenAI –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –æ—Ç–≤–µ—Ç;
- –≤–µ–¥—ë—Ç –ø—Ä–æ—Å—Ç—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –≤ –ª–æ–∫–∞–ª—å–Ω–æ–π SQLite-–±–∞–∑–µ.

---

## –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- `/start` ‚Äî –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –∏ –≤—ã–≤–æ–¥ –≥–ª–∞–≤–Ω–æ–≥–æ –º–µ–Ω—é.
- `/help` ‚Äî –∫—Ä–∞—Ç–∫–∞—è —Å–ø—Ä–∞–≤–∫–∞.
- `/about` ‚Äî –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –±–æ—Ç–µ.
- `/reset` ‚Äî —Å–±—Ä–æ—Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –¥–∏–∞–ª–æ–≥–∞ –∏ —Å—á—ë—Ç—á–∏–∫–æ–≤ –Ω–∞—Ä—É—à–µ–Ω–∏–π.
- `/context` ‚Äî –ø–æ–∫–∞–∑–∞—Ç—å —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤, –Ω–∞—Ä—É—à–µ–Ω–∏–π, mute-—Å—Ç–∞—Ç—É—Å –∏ —Ç.–ø.).

–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:

- üîç **–§–∏–ª—å—Ç—Ä —Ç–æ–∫—Å–∏—á–Ω–æ—Å—Ç–∏**
  - –õ–æ–∫–∞–ª—å–Ω—ã–π —Å–ª–æ–≤–∞—Ä—å —Ä—É—Å—Å–∫–æ–≥–æ –º–∞—Ç–∞ (soft-–Ω–∞—Ä—É—à–µ–Ω–∏—è).
  - –†–µ–≥—É–ª—è—Ä–∫–∏ –Ω–∞ –æ–ø–∞—Å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã: –≤–∑—Ä—ã–≤—á–∞—Ç–∫–∞, —Å—É–∏—Ü–∏–¥ –∏ —Ç.–ø. (hard-–Ω–∞—Ä—É—à–µ–Ω–∏—è).
  - (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –ø—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ **OpenAI Moderation**.

- üßπ **–†–∞–±–æ—Ç–∞ —Å –Ω–∞—Ä—É—à–µ–Ω–∏—è–º–∏**
  - –ü—Ä–∏ soft/hard-–Ω–∞—Ä—É—à–µ–Ω–∏—è—Ö –±–æ—Ç –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å –≤ –º–æ–¥–µ–ª—å.
  - –ù–∞–∫–∞–ø–ª–∏–≤–∞—é—Ç—Å—è —Å—á—ë—Ç—á–∏–∫–∏ –Ω–∞—Ä—É—à–µ–Ω–∏–π, –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –ø–æ—Ä–æ–≥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—Ä–µ–º–µ–Ω–Ω–æ ¬´–≤ –º—É—Ç–µ¬ª.
  - –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø–æ –∫–ª—é—á–µ–≤–æ–º—É —Å–ª–æ–≤—É ¬´*–ø–æ–∂–∞–ª—É–π—Å—Ç–∞*¬ª.

- ‚úèÔ∏è **–ü–µ—Ä–µ—Ñ—Ä–∞–∑–∏—Ä–æ–≤–∞–Ω–∏–µ (inline-–∫–Ω–æ–ø–∫–∏)**
  - –ü—Ä–∏ –º–∞—Ç–µ –±–æ—Ç –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –±–æ–ª–µ–µ –≤–µ–∂–ª–∏–≤—ã–π –≤–∞—Ä–∏–∞–Ω—Ç —Ñ—Ä–∞–∑—ã.
  - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç:
    - ‚úÖ ¬´–û—Ç–ø—Ä–∞–≤–∏—Ç—å —ç—Ç–æ—Ç –≤–∞—Ä–∏–∞–Ω—Ç¬ª ‚Äî –±–æ—Ç —Å–∞–º –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ø–µ—Ä–µ—Ñ—Ä–∞–∑ –≤ –º–æ–¥–µ–ª—å –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –æ—Ç–≤–µ—Ç.
    - ‚ùå ¬´–ù–µ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å¬ª ‚Äî —Å–µ—Å—Å–∏—è –ø–µ—Ä–µ—Ñ—Ä–∞–∑–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è.

- üíæ **–ö–æ–Ω—Ç–µ–∫—Å—Ç –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞**
  - SQLite-—Ç–∞–±–ª–∏—Ü—ã:
    - `users` ‚Äî –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è—Ö, –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞—Ö –∑–∞–ø—Ä–æ—Å–æ–≤/–Ω–∞—Ä—É—à–µ–Ω–∏–π, mute-—Å—Ç–∞—Ç—É—Å–µ.
    - `dialog_messages` ‚Äî –∏—Å—Ç–æ—Ä–∏—è –¥–∏–∞–ª–æ–≥–∞ (–¥–ª—è —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –∑–∞–ø—Ä–æ—Å–∞ –≤ –º–æ–¥–µ–ª—å).
  - –õ–∏–º–∏—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –∑–∞–¥–∞—ë—Ç—Å—è –≤ `bot/config.py` (`DIALOG_CONTEXT_LIMIT`).

---

## –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- Python 3.8+ (–Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è 3.8; —Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ 3.10+).
- [python-telegram-bot 21.x](https://docs.python-telegram-bot.org/).
- [OpenAI Python SDK 1.x](https://platform.openai.com/).
- SQLite (—á–µ—Ä–µ–∑ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –º–æ–¥—É–ª—å `sqlite3`).
- pytest ‚Äî –¥–ª—è –ø—Ä–æ—Å—Ç—ã—Ö —é–Ω–∏—Ç-—Ç–µ—Å—Ç–æ–≤.

---

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫ (–ª–æ–∫–∞–ª—å–Ω–æ / –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ)

### 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π

```bash
git clone https://github.com/Ilgiz-creator/tatar-san-bot.git
cd tatar-san-bot
```

### 2. –°–æ–∑–¥–∞—Ç—å –∏ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ

```bash
python3 -m venv venv
source venv/bin/activate  # Linux / macOS

# Windows (PowerShell):
# python -m venv venv
# .env\Scriptsctivate
```

### 3. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

```bash
pip install --upgrade pip
pip install -r requirements.txt
```

### 4. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –Ω–∞–±–æ—Ä:

- `TELEGRAM_BOT_TOKEN` **–∏–ª–∏** `TELEGRAM_TOKEN` ‚Äî —Ç–æ–∫–µ–Ω –±–æ—Ç–∞ –æ—Ç `@BotFather`.
- `OPENAI_API_KEY` ‚Äî –∫–ª—é—á OpenAI (–Ω—É–∂–µ–Ω –¥–ª—è –æ—Ç–≤–µ—Ç–æ–≤ –∏ –¥–ª—è Moderation; –±–µ–∑ –Ω–µ–≥–æ –±–æ—Ç –±—É–¥–µ—Ç –æ—Ç–≤–µ—á–∞—Ç—å —Ç–æ–ª—å–∫–æ —á–∞—Å—Ç—å—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞).
- `BOT_DB_PATH` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) ‚Äî –ø—É—Ç—å –∫ –±–∞–∑–µ SQLite. –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é —Å–æ–∑–¥–∞—ë—Ç—Å—è —Ñ–∞–π–ª `bot.db` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞.

–ü—Ä–∏–º–µ—Ä –¥–ª—è Linux/macOS:

```bash
export TELEGRAM_BOT_TOKEN=1234567890:ABCDEF_your_token_here
export OPENAI_API_KEY=sk-xxxxxxxxxxxxxxxxxxxxxxxxxxxx
# export BOT_DB_PATH=/path/to/bot.db   # –µ—Å–ª–∏ –Ω—É–∂–Ω–æ —Å–≤–æ—ë –º–µ—Å—Ç–æ
```

### 5. –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞

–ò–∑ –∫–æ—Ä–Ω—è –ø—Ä–æ–µ–∫—Ç–∞:

```bash
python -m bot.main
```

–ë–æ—Ç –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –≤ —Ä–µ–∂–∏–º–µ **long polling** –∏ –Ω–∞—á–∏–Ω–∞–µ—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –≤—Ö–æ–¥—è—â–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –∏ –Ω–∞–∂–∞—Ç–∏—è –Ω–∞ inline-–∫–Ω–æ–ø–∫–∏.

---

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```text
.
‚îú‚îÄ‚îÄ bot/
‚îÇ   ‚îú‚îÄ‚îÄ main.py          # —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –¢–µ–ª–µ–≥—Ä–∞–º-–±–æ—Ç–∞
‚îÇ   ‚îú‚îÄ‚îÄ config.py        # –∫–æ–Ω—Ñ–∏–≥ (—Ç–æ–∫–µ–Ω—ã, –ª–∏–º–∏—Ç—ã, –ø—É—Ç—å –∫ –ë–î)
‚îÇ   ‚îú‚îÄ‚îÄ keyboards.py     # –æ—Å–Ω–æ–≤–Ω–∞—è reply-–∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞
‚îÇ   ‚îú‚îÄ‚îÄ handlers/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ commands.py  # –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ /start, /help, /about, /reset, /context
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ messages.py  # –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ–±—ã—á–Ω—ã—Ö —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ callbacks.py # –æ–±—Ä–∞–±–æ—Ç–∫–∞ inline-–∫–Ω–æ–ø–æ–∫ –ø–µ—Ä–µ—Ñ—Ä–∞–∑–∏—Ä–æ–≤–∞–Ω–∏—è
‚îÇ   ‚îî‚îÄ‚îÄ services/
‚îÇ       ‚îú‚îÄ‚îÄ storage.py   # —Ä–∞–±–æ—Ç–∞ —Å SQLite (users, dialog_messages)
‚îÇ       ‚îú‚îÄ‚îÄ state.py     # –æ–±—ä–µ–∫—Ç UserState + –ª–æ–≥–∏–∫–∞ —Å–±—Ä–æ—Å–∞/–º—å—é—Ç–∞
‚îÇ       ‚îú‚îÄ‚îÄ moderation.py# –ª–æ–∫–∞–ª—å–Ω–∞—è –∏ OpenAI-–º–æ–¥–µ—Ä–∞—Ü–∏—è
‚îÇ       ‚îî‚îÄ‚îÄ ai_client.py # –≤—ã–∑–æ–≤—ã Chat Completions OpenAI
‚îú‚îÄ‚îÄ tests/
‚îÇ   ‚îú‚îÄ‚îÄ test_moderation.py
‚îÇ   ‚îî‚îÄ‚îÄ test_reset.py
‚îú‚îÄ‚îÄ requirements.txt
‚îî‚îÄ‚îÄ .gitignore
```

---

## –¢–µ—Å—Ç—ã

–ü—Ä–∏ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–Ω–æ–º –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–º –æ–∫—Ä—É–∂–µ–Ω–∏–∏:

```bash
pytest
# –∏–ª–∏
python -m pytest
```

–°–µ–π—á–∞—Å –ø–æ–∫—Ä—ã—Ç—ã:

- –ª–æ–∫–∞–ª—å–Ω—ã–π —Ñ–∏–ª—å—Ç—Ä –º–∞—Ç–∞ (`contains_local_profanity`);
- –ª–æ–≥–∏–∫–∞ —Å–±—Ä–æ—Å–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (`reset_state`).